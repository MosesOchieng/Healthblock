<!DOCTYPE html>
<html>
<head>
    <!-- Include Web3.js and ENS.js libraries -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eth-ens-namehash@2.0.0/dist/eth-ens-namehash.min.js"></script>
</head>
<body>
    <button id="loginButton">Login with ENS</button>

    <!-- ENS Registration Popup -->
    <div id="ensPopup" style="display: none;">
        <input type="text" id="ensNameInput" placeholder="Enter your ENS name">
        <button id="registerENSButton">Register</button>
    </div>

    <!-- ENS Name Display -->
    <div id="ensNameDisplay" style="display: none;">
        <h2>Logged in with ENS:</h2>
        <p id="ensName"></p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            if (window.ethereum) {
                window.web3 = new Web3(ethereum);
                try {
                    await ethereum.request({ method: 'eth_requestAccounts' });
                    initContracts();
                } catch (error) {
                    console.error("User denied account access");
                }
            } else if (window.web3) {
                window.web3 = new Web3(web3.currentProvider);
                initContracts();
            } else {
                console.error("No Ethereum browser extension detected");
            }
            
            // Display existing ENS name on page load if available
            const accounts = await web3.eth.getAccounts();
            await displayENSName(accounts[0]);
        });
        
        async function initContracts() {
            try {
                // Initialize your contracts and interactions here
            } catch (error) {
                console.error("Error initializing contracts:", error);
            }
        }
        
        async function displayENSName(address) {
            try {
                const ensName = await getENSName(address);
                document.getElementById("ensName").textContent = ensName || "Not Set";
            } catch (error) {
                console.error("Error displaying ENS name:", error);
            }
        }
        
        async function getENSName(address) {
            const reverseRegistrarAddress = "0x0000000000000000000000000000000000000064"; // Replace with actual ReverseRegistrar contract address
            const reverseRegistrarAbi = [/* ReverseRegistrar ABI */]; // Replace with actual ABI
            
            const reverseRegistrar = new web3.eth.Contract(reverseRegistrarAbi, reverseRegistrarAddress);
            const ensName = await reverseRegistrar.methods.name(address).call();
            return ensName;
        }
        
    </script>
</body>
</html>
